summary: Chisel can fetch packages from unsupported releases

variants:
  - mantic

environment:
  ROOTFS: rootfs

execute: |
  mkdir "${ROOTFS}"

  # TODO: change to the upstream release when it has maintenance set.
  ! OUTPUT=$(chisel cut --release ./release-${RELEASE} --root ${ROOTFS} hello_bins 2>&1)
  echo "$OUTPUT" | grep "cannot use unmaintained release, consider using --ignore"

  OUTPUT=$(chisel cut --release ./release-${RELEASE} --root ${ROOTFS} --ignore=unmaintained hello_bins 2>&1)
  echo "$OUTPUT" | grep "Warning: This release is no longer officially maintained, consider changing to a newer release"

  test -f ${ROOTFS}/usr/bin/hello
  test -f ${ROOTFS}/usr/share/doc/hello/copyright

  # Remove the maintenance block.
  sed -e "/maintenance:/,+3d" -i ./release-${RELEASE}/chisel.yaml
  ! chisel cut --release ./release-${RELEASE} --root ${ROOTFS} --ignore=unmaintained
  ! chisel cut --release ./release-${RELEASE} --root ${ROOTFS} hello_bins
